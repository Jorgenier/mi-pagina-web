<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrito | Mi Tienda</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="header-inner container">
      <a class="brand" href="index.html"><img src="img/logo.png" alt="Mi Tienda" class="logo"><span class="brand-text">Mi Tienda</span></a>
      <nav class="nav" aria-label="Navegación principal">
        <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu" onclick="toggleMenu()" aria-label="Abrir menú">☰</button>
        <ul id="nav-menu">
          <li><a href="index.html">Inicio</a></li>
        </ul>
      </nav>
      <a href="carrito.html" class="carrito-icono" aria-label="Ver carrito"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4" stroke="#111" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="10" cy="20" r="1" fill="#111"/><circle cx="18" cy="20" r="1" fill="#111"/></svg><span id="contador-carrito" aria-live="polite">0</span></a>
    </div>
  </header>

  <main class="main-wrap container">
    <h1>Tu carrito</h1>
    <div id="lista-carrito"></div>
    <div id="resumen-carrito" style="margin-top:1rem;"></div>

    <div style="margin-top:1rem;">
      <button onclick="vaciarCarrito()" style="background:#ff4d4d;color:#fff;padding:.6rem 1rem;border-radius:8px;border:0;">Vaciar carrito</button>
      <a id="checkout-link" href="#" style="display:inline-block;margin-left:12px;background:#0077cc;color:#fff;padding:.6rem 1rem;border-radius:8px;text-decoration:none;">Ir a Checkout</a>
    </div>
  </main>

  <footer class="footer-pro" role="contentinfo"><div class="footer-copy container"><p>©2025 Mi Tienda | Todos los derechos reservados</p></div></footer>

  <script>
    function mostrarCarrito() {
      const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      const cont = document.getElementById('lista-carrito');
      const resumen = document.getElementById('resumen-carrito');
      if (!cont) return;
      if (carrito.length === 0) {
        cont.innerHTML = '<p>No hay productos en el carrito.</p>';
        resumen.innerHTML = '';
        return;
      }
      cont.innerHTML = carrito.map((p, i) => `
        <div class="item-carrito" style="display:flex;gap:1rem;align-items:center;border:1px solid #eaeaea;padding:1rem;border-radius:8px;margin-bottom:0.75rem;flex-wrap:wrap;">
          <img src="${p.imagen}" alt="${p.nombre}" style="width:90px;height:70px;object-fit:cover;border-radius:6px;">
          <div style="flex:1;min-width:160px;">
            <h3 style="margin:0 0 .25rem 0;">${p.nombre}</h3>
            <p style="margin:0;color:#666;">Precio: ${Number(p.precio).toFixed(2)} €</p>
            <div style="margin-top:.5rem;display:flex;gap:.5rem;align-items:center;">
              <button onclick="cambiarCantidad(${i}, -1)" style="width:34px;height:34px;border-radius:6px;border:1px solid #ddd;background:#fff;cursor:pointer;">−</button>
              <span id="cant-${i}" style="min-width:28px;text-align:center;display:inline-block;">${p.cantidad || 1}</span>
              <button onclick="cambiarCantidad(${i}, 1)" style="width:34px;height:34px;border-radius:6px;border:1px solid #ddd;background:#fff;cursor:pointer;">+</button>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:.5rem;align-items:flex-end;min-width:120px;">
            <div style="font-weight:700;">${(Number(p.precio) * (p.cantidad || 1)).toFixed(2)} €</div>
            <button onclick="eliminarDelCarrito(${i})" style="background:#fff;border:1px solid #ddd;padding:.4rem .6rem;border-radius:6px;cursor:pointer;">Eliminar</button>
          </div>
        </div>
      `).join('');
      const total = carrito.reduce((s, it) => s + (Number(it.precio) * (Number(it.cantidad) || 1)), 0);
      resumen.innerHTML = `<strong>Total:</strong> ${total.toFixed(2)} €`;
      const checkout = document.getElementById('checkout-link'); if (checkout) checkout.href = '#';
    }

   function actualizarContadorCarrito() {
    const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    const totalCant = carrito.reduce((s, it) => s + (Number(it.cantidad) || 0), 0);
    const contador = document.getElementById('contador-carrito');
    if (contador) contador.textContent = totalCant;
  }

  document.addEventListener('DOMContentLoaded', actualizarContadorCarrito); 

    function cambiarCantidad(index, delta) {
      let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      if (!carrito[index]) return;
      carrito[index].cantidad = (Number(carrito[index].cantidad) || 1) + delta;
      if (carrito[index].cantidad <= 0) carrito.splice(index, 1);
      localStorage.setItem('carrito', JSON.stringify(carrito));
      mostrarCarrito();
      actualizarContadorCarrito();
    }

    function eliminarDelCarrito(index) {
      let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      carrito.splice(index, 1);
      localStorage.setItem('carrito', JSON.stringify(carrito));
      mostrarCarrito();
      actualizarContadorCarrito();
    }

    function vaciarCarrito() {
      localStorage.removeItem('carrito');
      mostrarCarrito();
      actualizarContadorCarrito();
      mostrarToast('Carrito vaciado');
    }

    document.addEventListener('DOMContentLoaded', () => { mostrarCarrito(); actualizarContadorCarrito(); });
  </script>
</body>
</html>